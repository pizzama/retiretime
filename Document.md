# RetireTime 应用文档

## 项目概述

RetireTime是一个iOS应用，用于跟踪倒计时事件，特别是退休日期倒计时。它允许用户创建、管理和查看各种类型的事件，包括退休日和一般倒计时事件。应用支持照片显示、相框样式自定义以及子事件管理。

## 主要功能

### 1. 事件管理
- 支持创建、编辑和删除事件
- 事件类型：退休日、倒计时
- 事件分类管理
- 支持多种日历类型

### 2. 事件显示
- 置顶事件显示：事件名称、剩余/已过天数、具体时间
- 分类事件列表：按照分类显示，每行3个
- 每个事件卡片：上方照片，下方信息

### 3. 照片与相框功能
- 选择照片：选择照片并应用到事件
- 拍立得效果：照片样式采用拍立得效果
- 自定义相框：选择不同风格的相框
- 照片处理：调整照片大小和位置

### 4. 子事件管理
- 创建子事件：为主事件创建子事件
- 子事件列表：每行显示2个子事件
- 子事件功能：更换照片、更换相框、编辑基本信息

### 5. 提醒功能
- 设置事件提醒
- 支持不同类型的通知声音
- 可启用或禁用震动

### 6. 主屏幕小组件
- 支持iOS小组件功能
- 显示即将到来的重要事件
- 可配置显示的事件类型
- 支持多种尺寸的小组件

## 项目结构

```
retiretime/
├── Models/                     # 数据模型
│   ├── Event.swift            # 事件模型及相关枚举
│   └── NotificationTypes.swift # 通知类型定义
├── Views/                      # 视图组件
│   ├── EventListView.swift    # 事件列表视图
│   ├── EventDetailView.swift  # 事件详情视图
│   └── EventFormView.swift    # 事件创建/编辑表单
├── Services/                   # 服务组件
│   ├── EventStore.swift       # 事件数据存储服务
│   ├── NotificationManager.swift # 通知管理服务
│   └── WidgetPromptManager.swift # 小组件提示管理
├── Assets.xcassets/           # 资源文件
├── TemplateImageGenerator.swift # 模板图片生成器
├── retiretimeApp.swift        # 应用入口
└── ContentView.swift          # 内容视图

widgets/                        # 小组件功能
├── widgets.swift              # 小组件主要实现
├── widgetsBundle.swift        # 小组件集合配置
├── Event.swift                # 小组件事件模型(与主应用共享)
├── NotificationTypes.swift    # 通知类型(与主应用共享)
├── ConfigurationIntent.intentdefinition # 小组件配置定义
└── Assets.xcassets/           # 小组件资源文件
```

## 数据模型

### Event 模型
主要属性包括：
- 基本信息：ID、名称、日期、类型、分类
- 照片相关：图片名称、相框样式、照片调整参数
- 提醒设置：是否启用提醒、提醒日期、通知声音
- 退休日特有属性：出生日期、性别

### 枚举类型
- CalendarType：公历、农历、伊斯兰教历等
- EventType：退休日、倒计时
- Gender：性别（用于计算退休年龄）
- RepeatType：事件重复类型
- FrameStyle：相框样式

## 主要视图

### 1. EventListView
- 显示置顶事件和分类事件列表
- 支持按分类筛选事件
- 每个事件显示照片和基本信息

### 2. EventDetailView
- 显示事件详细信息
- 照片拍立得效果
- 相框选择功能
- 子事件管理
- 照片调整预览

### 3. EventFormView
- 创建和编辑事件的表单
- 设置事件基本信息、提醒等

## 服务组件

### EventStore
- 管理事件数据的存储和读取
- 提供事件筛选、分类功能
- 支持子事件管理
- 处理重复事件逻辑

### NotificationManager
- 管理事件提醒通知
- 调度和移除通知

### WidgetPromptManager
- 管理小组件显示内容

## 小组件功能

应用提供了iOS主屏幕小组件功能，用户可以在主屏幕上查看即将到来的事件倒计时。

### 小组件特性
- 支持多种尺寸：小、中、大尺寸
- 显示即将到来的事件：事件名称、剩余天数、日期
- 点击小组件可直接跳转到应用相应的事件详情页
- 通过App Group实现主应用与小组件之间的数据共享
- 支持小组件配置，用户可以选择显示的事件类型

### 数据共享机制
- 使用App Group的UserDefaults实现主应用与小组件的数据共享
- 当主应用中的事件数据发生变化时，会刷新所有小组件

## 待实现功能

1. 小组件事件显示：在顶部增加显示当前事件的小组件
2. 照片样式改进：实现拍立得效果，事件名显示在白底上
3. 相框自定义功能：增加相框选择按钮，实现相框叠加效果
4. 子事件功能：增加创建和管理子事件的功能
5. 照片预览调整：实现照片大小和位置的调整
6. 界面优化：统一首页和子事件的列表显示样式
7. 混合模式相框：使用混合模式让相框遮罩照片

## 技术栈

- SwiftUI：用户界面开发
- Combine：数据流管理
- WidgetKit：小组件支持
- PhotosUI：照片选择和处理
- UserDefaults/AppGroup：数据持久化和共享
- App Intents：小组件配置

## 系统要求

- iOS 17.0 及以上版本
- iPhone 和 iPad设备支持
- 支持深色模式
- 支持 WidgetKit 和 App Intents
- 需要照片库访问权限（用于选择照片）
- 需要通知权限（用于事件提醒）

## 总结

RetireTime 是一款功能丰富的事件倒计时应用，特别适合追踪重要日期，如退休日、纪念日等。应用采用现代 SwiftUI 架构，提供了美观的用户界面和丰富的自定义选项。主要亮点包括照片相框功能、子事件管理和 iOS 小组件支持。未来的开发重点将放在增强照片展示效果、相框样式自定义以及优化整体用户体验上。
