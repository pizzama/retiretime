# RetireTime 应用文档

## 项目概述

RetireTime是一个iOS应用，用于跟踪倒计时事件，特别是退休日期倒计时。它允许用户创建、管理和查看各种类型的事件，包括退休日和一般倒计时事件。应用支持照片显示、相框样式自定义以及子事件管理。

## 主要功能

### 1. 事件管理
- 支持创建、编辑和删除事件
- 事件类型：退休日、倒计时
- 事件分类管理
- 支持多种日历类型

### 2. 事件显示
- 置顶事件显示：事件名称、剩余/已过天数、具体时间
- 分类事件列表：按照分类显示，每行3个
- 每个事件卡片：上方照片，下方信息

### 3. 照片与相框功能
- 选择照片：选择照片并应用到事件
- 拍立得效果：照片样式采用拍立得效果
- 自定义相框：选择不同风格的相框
- 照片处理：调整照片大小和位置

### 4. 子事件管理
- 创建子事件：为主事件创建子事件
- 子事件列表：每行显示2个子事件
- 子事件功能：更换照片、更换相框、编辑基本信息

### 5. 提醒功能
- 设置事件提醒
- 支持不同类型的通知声音
- 可启用或禁用震动

### 6. 主屏幕小组件
- 支持iOS小组件功能
- 显示即将到来的重要事件
- 可配置显示的事件类型
- 支持多种尺寸的小组件

## 项目结构

```
retiretime/
├── Models/                     # 数据模型
│   ├── Event.swift            # 事件模型及相关枚举
│   └── NotificationTypes.swift # 通知类型定义
├── Views/                      # 视图组件
│   ├── EventListView.swift    # 事件列表视图
│   ├── EventDetailView.swift  # 事件详情视图
│   └── EventFormView.swift    # 事件创建/编辑表单
├── Services/                   # 服务组件
│   ├── EventStore.swift       # 事件数据存储服务
│   ├── NotificationManager.swift # 通知管理服务
│   └── WidgetPromptManager.swift # 小组件提示管理
├── Assets.xcassets/           # 资源文件
├── TemplateImageGenerator.swift # 模板图片生成器
├── retiretimeApp.swift        # 应用入口
└── ContentView.swift          # 内容视图

widgets/                        # 小组件功能
├── widgets.swift              # 小组件主要实现
├── widgetsBundle.swift        # 小组件集合配置
├── Event.swift                # 小组件事件模型(与主应用共享)
├── NotificationTypes.swift    # 通知类型(与主应用共享)
├── ConfigurationIntent.intentdefinition # 小组件配置定义
└── Assets.xcassets/           # 小组件资源文件
```

## 数据模型

### Event 模型
主要属性包括：
- 基本信息：ID、名称、日期、类型、分类
- 照片相关：图片名称、相框样式、照片调整参数
- 提醒设置：是否启用提醒、提醒日期、通知声音
- 退休日特有属性：出生日期、性别

### 枚举类型
- CalendarType：公历、农历、伊斯兰教历等
- EventType：退休日、倒计时
- Gender：性别（用于计算退休年龄）
- RepeatType：事件重复类型
- FrameStyle：相框样式

# 退休时间应用页面结构文档

## 1. 首页/事件列表 (EventListView)
### 核心功能
- 显示所有退休事件的纵向滚动列表
- 列表项包含：
  - 事件封面图（带相框效果）
  - 事件名称
  - 时间倒计时/正计时
  - 简要描述
- 顶部导航栏：
  - 应用Logo 
  - "新建事件" 按钮（+图标）

### 交互功能
- 下拉刷新列表
- 滑动删除事件
- 点击事件卡片跳转至详情页
- 浮动操作按钮（FAB）快速新建事件

## 2. 事件详情页 (EventDetailView)
### 页面结构
- 顶部画廊视图（可左右滑动）：
  - 大图展示区（带当前相框效果）
  - 照片缩略图导航条

### 功能区域
1. 事件信息模块：
   - 事件名称（可编辑）
   - 起止时间
   - 重要程度标签
   - 进度条（根据子事件完成情况）

2. 操作工具栏：
   - 编辑按钮（✏️）
   - 添加照片按钮（🖼️）
   - 更换相框按钮（🖼️）
   - 背景设置按钮（🎨）
   - 分享按钮（📤）

3. 子事件管理：
   - 折叠面板显示所有子事件
   - "+ 添加子事件" 入口
   - 子事件完成状态开关

## 3. 照片预览视图 (PhotoPreviewView)
### 核心功能
- 多点触控缩放（双指手势）
- 单指拖动调整位置
- 实时显示相框/背景效果
- 撤销/重做操作按钮

### 底部工具栏
- 保存修改按钮（💾）
- 放弃修改按钮（❌）
- 装饰增强按钮（✨）
- 滤镜调整滑块

## 4. 相框选择页面 (FramePickerView)
### 交互设计
- 分类标签栏：
  - 经典木纹
  - 金属质感  
  - 卡通风格
  - 自定义上传
- 网格布局展示相框样式
- 点击立即应用预览
- 长按查看相框详情

## 5. 背景选择页面 (BackgroundPickerView)
### 功能特性
- 动态背景预览窗口
- 背景类型切换：
  - 纯色渐变
  - 纹理图案
  - 场景化背景（如书房、花园）
  - 智能AI生成
- 透明度调节控件
- 历史使用记录栏

## 6. 事件编辑页面 (EventEditView)
### 表单字段
- 事件名称（必填）
- 时间选择器（日期+时间）
- 重复提醒设置：
  - 每日/每周/每月
  - 自定义周期
- 重要性等级（⭐️1-5）
- 关联联系人选择
- 备注文本框

## 7. 子事件表单 (ChildEventFormView)
### 特殊功能
- 自动继承主事件时间线
- 里程碑进度设置
- 依赖关系设置（前置事件）
- 完成条件选择：
  - 手动确认
  - 照片上传验证
  - 地理位置验证

## 8. 装饰选择视图 (DecorationPickerView)
### 特色功能
- 拍立得效果生成器
- 虚拟贴纸商店入口
- 文字水印编辑器
- 组合装饰方案保存

## WidgetPromptManager
- 管理小组件显示内容

## 小组件功能

应用提供了iOS主屏幕小组件功能，用户可以在主屏幕上查看即将到来的事件倒计时。

### 小组件特性
- 支持多种尺寸：小、中、大尺寸
- 显示即将到来的事件：事件名称、剩余天数、日期
- 点击小组件可直接跳转到应用相应的事件详情页
- 通过App Group实现主应用与小组件之间的数据共享
- 支持小组件配置，用户可以选择显示的事件类型

### 数据共享机制
- 使用App Group的UserDefaults实现主应用与小组件的数据共享
- 当主应用中的事件数据发生变化时，会刷新所有小组件

## 待实现功能

1. 小组件事件显示：在顶部增加显示当前事件的小组件
2. 照片样式改进：实现拍立得效果，事件名显示在白底上
3. 相框自定义功能：增加相框选择按钮，实现相框叠加效果
4. 子事件功能：增加创建和管理子事件的功能
5. 照片预览调整：实现照片大小和位置的调整
6. 界面优化：统一首页和子事件的列表显示样式
7. 混合模式相框：使用混合模式让相框遮罩照片

## 技术栈

- SwiftUI：用户界面开发
- Combine：数据流管理
- WidgetKit：小组件支持
- PhotosUI：照片选择和处理
- UserDefaults/AppGroup：数据持久化和共享
- App Intents：小组件配置

## 系统要求

- iOS 17.0 及以上版本
- iPhone 和 iPad设备支持
- 支持深色模式
- 支持 WidgetKit 和 App Intents
- 需要照片库访问权限（用于选择照片）
- 需要通知权限（用于事件提醒）

## 总结

RetireTime 是一款功能丰富的事件倒计时应用，特别适合追踪重要日期，如退休日、纪念日等。应用采用现代 SwiftUI 架构，提供了美观的用户界面和丰富的自定义选项。主要亮点包括照片相框功能、子事件管理和 iOS 小组件支持。未来的开发重点将放在增强照片展示效果、相框样式自定义以及优化整体用户体验上。
